#!/bin/bash

# Указываем директорию с подключенной платой (замените 'CIRCUITPY' при необходимости)
MOUNT_POINT="/Volumes/CIRCUITPY"

# Проверяем, смонтирована ли плата
if [ ! -d "$MOUNT_POINT" ]; then
    echo "Ошибка: Плата CircuitPython не найдена. Проверьте подключение."
    exit 1
fi

# Создаем резервную копию файлов из MOUNT_POINT в папку .backup
BACKUP_DIR="./.backup"
mkdir -p "$BACKUP_DIR"

echo "Создание резервной копии из $MOUNT_POINT в $BACKUP_DIR..."
cp -r "$MOUNT_POINT"/* "$BACKUP_DIR"
if [ $? -ne 0 ]; then
    echo "Ошибка при создании резервной копии. Проверьте права доступа."
    exit 2
fi
echo "Резервная копия успешно создана."

# Удаляем лишние файлы с платы перед копированием (если нужно очистить директорию)
# echo "Очистка целевой директории на плате..."
# rm -r "$MOUNT_POINT"/*  # Раскомментируйте, если нужно удалять файлы перед копированием.

# Копируем только .py файлы из текущей директории на плату
echo "Копирование файлов .py из текущей директории на плату CircuitPython..."
find . -maxdepth 1 -name "*.py" -exec cp {} "$MOUNT_POINT" \;
if [ $? -ne 0 ]; then
    echo "Ошибка при копировании файлов. Проверьте доступность платы."
    exit 3
fi

echo "Все файлы .py успешно скопированы в $MOUNT_POINT."
